/**
  mp-ratings is a client to pull ratings info from Matchplay.events
*/

const agent = require('superagent');
const moment = require('moment');

// https://matchplay.events/data/ifpa/ratings/2017-12-13/2576,3238,3287,611,3276,26374,21384,54,39139,8891,6160,6143,21615,16788,31725,20712,6835,23996,28813,8893,38463,10919,45585,21493,38462,36803,29083,17127,42483,44230,49529,6142,3289,41582,16787,609,20059,27227,2585,36802,21560,31961,17104,3271,41039,24525,16570,28877,24208,17537,21061,18829,39188,49952,19493,49098,51823,31731,16574,30042,24660,13577,18884,45876,52531,20094,9383,24011,32895,23896,53620,44243,34526,30396,33174,20057,24519,39582,22985,27493,14840,33031,24018,17604,22822,31625,20534,10819,19324,52617,33168,45438,27226,37362,40838,58131,49079,42480,14390,50324,40883,49083,17394,34418,47775,9141,44544,40884,40794,41581,34117,23040,48099,53964,15561,33169,37159,27503,25650,44242,53621,56658,23901,33171,42813,34108,48188,57448,48097,48190,39458,36832,57266,52791,21367,35492,31811,14503,12360,17535,41764,21897,24013,51260,4786,9142,40652,54257,35499,52722,54153,47239,29143,19497,39581,27323,32819,24007,26328,35157,44541,58059,48096,57702,33167,31959,49667,41037,33062,56113,39078,38315,47780,56594,20060,37557,3317,42216,45880,54117,48642,42077,44231,43772,56657,35662,49363,41500,16302,50126,43627,56969,40885,42014,54914,47061,22839,41036,48168,48095,41611,50374,40425,42481,6837,711,43204,1380,41038,50081,30041,47285,20058,49477,6823,22995,39585,50869,12961,9226,1380,45375,21896,49364,7073,1651,8266,52943,25523,38325,34371,23614,40843,41585,41609,12961,35080,25955,44839,17701,17702,24907,40841,26409,34115,1710,20392,12716,51863,41196,58241,20058,2599,39949,33061,9403,37360,47538,56775,49080,49156,35952,24748,50373,51575,58391,50073,43771,48477,44388,54608,39967,48646,27230,45886,43094,57263,54262,52563,45913,37391,34399,45715,57423



function fetch(ids) {
  return new Promise((resolve, reject) => {
    // NOTE Polling today returned a 404. In fact, I had to go back a ways to find valid results.
    const date = moment().subtract(1, 'M').format('YYYY-MM-DD');
    const url = `https://matchplay.events/data/ifpa/ratings/${date}/${ids.join(',')}`;
    console.log('URL:', url);
    agent.get(url).then(res => {
      const list = res.body;
      console.log(Array.isArray(list));
      console.log(list);
      resolve(list);
    })
    .catch(reject);
  });

}

fetch([2576,3238,3287,611,3276,26374,21384]).then(() => console.log('ALL DONE'));
